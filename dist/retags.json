{"id":"retags","script":"//* TITLE       Retags **//\r\n//* DEVELOPER   alexhong **//\r\n//* VERSION     0.6.6 **//\r\n//* DESCRIPTION Adds tags to reblog notes **//\r\n//* FRAME       false **//\r\n//* SLOW        false **//\r\n//* BETA        false **//\r\n\r\nvar retags = {\r\n\tapi_key: '3DFxEZm0tGISOmdvWe9Fl1QsQMo1LFqEatnc8GQ68wgF1YTZ4w',\r\n\tselectors: '.reblog,.is_reblog,.notification_reblog',\r\n\tblog_name: \"\",\r\n\tobserver: new MutationObserver(function(ms){\r\n\t\tms.forEach(function(m){\r\n\t\t\tretags.tag($(m.addedNodes).filter(retags.selectors));\r\n\t\t});\r\n\t}),\r\n\trun: function(){\r\n\t\tretags.css.appendTo('head');\r\n\t\ttry {\r\n\t\t\tretags.blog_name = $('body').data('new-root').split('/').pop();\r\n\t\t} catch(e) {\r\n\r\n\t\t}\r\n\t\tretags.add_toggle();\r\n\t\tretags.observer.observe($('body')[0],{childList:true,subtree:true});\r\n\t\tretags.tag(retags.selectors);\r\n\t\t/*$('body').on('mouseover.retags','.post_tags_inner',function(){\r\n\t\t\t$(this).attr('class','DISABLED_post_tags_inner');\r\n\t\t});*/\r\n\t},\r\n\tdestroy: function(){\r\n\t\tretags.css.detach();\r\n\t\tretags.css_toggle.detach();\r\n\t\tretags.html_toggle.detach();\r\n\t\tretags.observer.disconnect();\r\n\t\t$('.retags').remove();\r\n\t\t$('body').off('.retags');\r\n\t\t// $('.DISABLED_post_tags_inner').attr('class','post_tags_inner');\r\n\t},\r\n\tadd_toggle: function(){\r\n\t\tvar toggle = 'retags_toggle_'+retags.blog_name;\r\n\t\tretags.html_toggle.appendTo('.ui_notes_switcher .part-toggle');\r\n\t\t$('#retags-toggle').change(function(){\r\n\t\t\tif ($(this).prop('checked')) {\r\n\t\t\t\tlocalStorage.setItem(toggle,'true');\r\n\t\t\t\tretags.css_toggle.appendTo('head');\r\n\t\t\t} else {\r\n\t\t\t\tlocalStorage.setItem(toggle,'false');\r\n\t\t\t\tretags.css_toggle.detach();\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (localStorage.getItem(toggle) === 'true') {\r\n\t\t\t$('#retags-toggle').click();\r\n\t\t}\r\n\t},\r\n\ttag: function(el){\r\n\t\t$(el).each(function(){\r\n\t\t\tvar $t = $(this), cls, $c, url;\r\n\t\t\tif ($t.find('div.retags').length) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\t// popover\r\n\t\t\tif ($t.hasClass('note')) {\r\n\t\t\t\tcls = 'with_commentary';\r\n\t\t\t\t$c = $t;\r\n\t\t\t\turl = $c.find('.action').data('post-url');\r\n\t\t\t// Activity\r\n\t\t\t} else if ($t.hasClass('ui_note')) {\r\n\t\t\t\tif ($t.find('.part_response').length) {\r\n\t\t\t\t\t$t.addClass('is_response');\r\n\t\t\t\t}\r\n\t\t\t\tcls = 'is_retags';\r\n\t\t\t\t$c = $t.find('.stage');\r\n\t\t\t\turl = $c.find('.part_glass').attr('href');\r\n\t\t\t// dashboard\r\n\t\t\t} else if ($t.hasClass('notification')) {\r\n\t\t\t\t$c = $t.find('.notification_sentence');\r\n\t\t\t\turl = $c.find('.notification_target').attr('href');\r\n\t\t\t}\r\n\t\t\tif (url) {\r\n\t\t\t\turl = url.split('/');\r\n\t\t\t\tvar host = url[2], id = url[4], cache = 'retags_'+id;\r\n\t\t\t\tif (localStorage.getItem(cache) !== null) {\r\n\t\t\t\t\tretags.append($t,cls,$c,JSON.parse(localStorage.getItem(cache)));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tretags.request($t,cls,$c,cache,'https://api.tumblr.com/v2/blog/'+host+'/posts/info?id='+id+'&api_key='+retags.api_key);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n\trequest:\r\n\t\t(typeof GM_xmlhttpRequest !== 'undefined')\r\n\t\t// if userscript or XKit\r\n\t\t? function($t,cls,$c,cache,url) {\r\n\t\t\tGM_xmlhttpRequest({\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\turl: url,\r\n\t\t\t\tonload: function(data){\r\n\t\t\t\t\tvar tags = JSON.parse(data.responseText).response.posts[0].tags;\r\n\t\t\t\t\tlocalStorage.setItem(cache,JSON.stringify(tags));\r\n\t\t\t\t\tretags.append($t,cls,$c,tags);\r\n\t\t\t\t},\r\n\t\t\t\tonerror: function(data){\r\n\t\t\t\t\tretags.append($t,cls,$c,'ERROR: '+data.status);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t// if Chrome extension\r\n\t\t: function($t,cls,$c,cache,url) {\r\n\t\t\t$.getJSON(url,function(data){\r\n\t\t\t\tvar tags = data.response.posts[0].tags;\r\n\t\t\t\tlocalStorage.setItem(cache,JSON.stringify(tags));\r\n\t\t\t\tretags.append($t,cls,$c,tags);\r\n\t\t\t}).fail(function(jqXHR,status,error){\r\n\t\t\t\tretags.append($t,cls,$c,status.toUpperCase()+': '+(error||jqXHR.status));\r\n\t\t\t});\r\n\t\t}\r\n\t,\r\n\tappend: function($t,cls,$c,tags){\r\n\t\tif (tags.length) {\r\n\t\t\tvar $retags = $('<div class=\"retags\">');\r\n\t\t\tif (typeof tags === 'string') {\r\n\t\t\t\t$retags.append(tags).addClass('error');\r\n\t\t\t} else {\r\n\t\t\t\ttags.forEach(function(tag){\r\n\t\t\t\t\t$retags.append('<a href=\"//tumblr.com/tagged/'+tag.replace(/ /g,'-')+'\">#'+tag+'</a>');\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t$t.addClass(cls);\r\n\t\t\t$c.append($retags);\r\n\t\t}\r\n\t},\r\n\tcss:\r\n\t$('<style class=\"retags\">\\\r\n\t\t.ui_notes .date_header .part_full_date.stuck { width: 165px; margin-left:400px; }\\\r\n\t\tlabel.retags { top: -1px; margin-left: 15px; }\\\r\n\t\tlabel.retags .binary_switch_label { position: absolute; top: 0; left: 24px; padding: 0 8px; line-height: 14px; white-space: nowrap; }\\\r\n\t\tdiv.retags { white-space: normal; margin-top: 10px; }\\\r\n\t\tdiv.retags.error { color: #c00000; }\\\r\n\t\tdiv.retags + div.retags:before { color: #c00000; content: \"Warning: You are running multiple copies of Retags.\"; }\\\r\n\t\tdiv.retags + div.retags a { display: none; }\\\r\n\t\tdiv.retags a { color: #a7a7a7 !important; position: relative; margin-right: 11px; text-decoration: none; }\\\r\n\t\tdiv.retags a:hover { color: #969696 !important; }\\\r\n\t\t.note div.retags { font-size: 12px; line-height: 1.3; }\\\r\n\t\t.note div.retags a { margin-right: 9px; }\\\r\n\t\t.post_notes .notes_outer_container.popover .note.with_commentary span.action { min-height: 0; }\\\r\n\t\t.notification div.retags a { color: rgba(255,255,255,0.3) !important; }\\\r\n\t\t.notification div.retags a:hover { color: rgba(255,255,255,0.4) !important; }\\\r\n\t\t.ui_note div.retags { margin-top: 0; padding: 40px 50px 13px; }\\\r\n\t\t.ui_note div.retags + div.retags { margin-top: -5px; padding-top: 0; }\\\r\n\t\t.ui_note .part_response + div.retags { margin-top: -7px; padding-top: 0; }\\\r\n\t\tdiv.retags a:after { content: \"\\\\00a0  \"; font-size: 0; line-height: 0; }\\\r\n\t</style>')\r\n\t,\r\n\tcss_toggle:\r\n\t$('<style class=\"retags\">\\\r\n\t\t.ui_note { display: none; }\\\r\n\t\t.ui_note.is_retags, .ui_note.is_response, .ui_note.is_user_mention { display: block; }\\\r\n\t</style>')\r\n\t,\r\n\thtml_toggle:\r\n\t$('<label class=\"retags binary_switch\">\\\r\n\t\t<input id=\"retags-toggle\" type=\"checkbox\">\\\r\n\t\t<span class=\"binary_switch_track\"></span>\\\r\n\t\t<span class=\"binary_switch_button\"></span>\\\r\n\t\t<span class=\"binary_switch_label\">Show only retags / responses</span>\\\r\n\t</label>')\r\n};\r\n\r\nXKit.extensions.retags = {\r\n \trunning: false,\r\n\trun: function(){\r\n\t\tthis.running = true;\r\n\t\tretags.run();\r\n\t},\r\n\tdestroy: function(){\r\n\t\tthis.running = false;\r\n\t\tretags.destroy();\r\n\t}\r\n};\r\n","icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MDA5QTFGNzNEOEYzMTFFM0ExRkJBMjU3NUY4MjNFRjciIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MDA5QTFGNzREOEYzMTFFM0ExRkJBMjU3NUY4MjNFRjciPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowMDlBMUY3MUQ4RjMxMUUzQTFGQkEyNTc1RjgyM0VGNyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowMDlBMUY3MkQ4RjMxMUUzQTFGQkEyNTc1RjgyM0VGNyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpAlVCQAAAVxSURBVHja7Fp7bFNVGP/d29LHxgZ7m73kpRKjqP9ojAmwIEYFQYn/zUQji8ZHopigxgQFQggiOBOYomhiovuDDCMxIWqMMZj4py+CL/Zoe1v2hjHZuq5bW8937+2aQe+95z7aroaTk5umPff7ft/7O+dUOONJoZiHG2JR4y92+MwCgoDrLlRYAdzFLkCxu5CA/2kM3BuEq8wiUel9SLsK7UKW0bPR/Dy8DejeXsxZqG4rmGq623JfyFgdyDodkGELbv4YWvSdmrmtA7Vb6Nn9bE5dyJVbE5MMzJeeWxh1YPwXBPZi8mcZ2VNY8RpcizlkeCSHMrgFbguM/4o/ttEH5ZWRzxA9hzu+5LPDZnr2vJiLblRE9nnNCO67es3k7xg+ze1Lm7GqA5rsrE4TFoiexbWLx75H7SZuGTZR3uh5qUAulHWlr8kcv5qHKR56dxTChWpasyyraDHNsuYhrGwvhAstewXRv8mR5kbjDpTfaUVtTAbmS70785tGXaW4vROj3+DSD/A1YOlai+iVUf0gPXtftR8DbtOMFd72B9ER0fd6MW8pqx+gZ98beclCOZUhsKs4LZCRQUDgzbzEQK5k2Eh5KbCnmDf1VffLvrTX7IZGRNY5/FVhZFj+FrQgZZ2aFgi3U+Kv2pB3GTakG0f7MRA6QCJWthRABsY3uN+JLBQ8QM/8y6BwVLjbrQOhdyjHVa43phUfxpWzmPgTi29VI9KuDAJCB50oZNJhWYZ1emv6P8fwifQm4Ttc/BpNL8PfZE+G9cRXOmStnZ4/pXdx6Uc93Q93zVsf7UHkQyd8aR2ad+oBE357zMQVk381vHXZf7p8hp4VG1G2hqSFTLV0DVbtdkCMoS8w2KnlQmZaidh5mtn3awqdGVTch1QckQ55F3oOPbvR2AZfoy0BfMuhhZMqgYMzOavGX8ML6jdsDxQ+bgv9lITwUU2Oeq2EfwVq2Dbcq/qD4Ugl4KlO5/IWIhw5Tu9OncfYT2QZK+jD6NuD5BS0cOoVsrrHUX6XrTwoeBA5JvtStxUBGPrAPiTj0AGpZwH7jaqnStVcfNQ8+ggC+5HQ1r2JdjqVxPQQUtNGt7JJOmmc86LJf+imQ6Ffutoc+lgEwbeRnDZWom47nf5pZgx9zJQxY8bl96D5GRl9N6QOJCaJiHsJKteaQX8BgYNIRMHT6nNVYiWFca2UWUb7EP6ABFZeSc3AXW4CffBQ5l2Ogy0BelMeE3+RFxmslKerhBAw9Ez3Ygn8K+lLFoWsQeJFfzite76pFwOKDlgHMdQlG4Gj5MXCkI4RAtFD9YtFTkxSbcI6PIN3+xFq5/J73krMflLQUxTehPhFzF42IDd9QTarGze0ouw2yoMKfZfPGL30noze5CGDXgyMfoupXrJDyS2ofwKhIxCucBGtfRRL71ZDQqWvCys2AOmInO/Nn/HobWimAsTYvwwNT0L0ITXL++cW9komj4nzElp29EdJ99YOeAyykK8JjU9TaDIGzK3FRVx5IQM3bQEtx5gepIhPWdK9sQW89aR75RZMWITG7dTtcKTSTC3LOI+QHT2LeMu6Nw7ipjY6mJgLaE+NaerKyYem7j+i6i7YOxrUs0B8BP5Se81QUtXuVZmRoWeNqk3dGwvQ30nJx3+j2g6xjE5xzHmSJ2L2X9rjK/QVIhn0nyARd+b/bnpBnJzBwAmSwVdP7cBAl9zbmPUimT6rIb4GGf0QIp8SZadOxQ3OhRIxWYZWeGspC1Fza21Tewqz47SfHjxF+d7BI3G3aKSJZBRDJ1G3jUqBOGGd01j6UEN09EaCa1PPlDdy2oGMkYvBe8GhbqkWoABCsf/tsuB3ZHlyoQVsgesuVNjxnwADACKdjtGZRJ7nAAAAAElFTkSuQmCC","title":"Retags","description":"Adds tags to reblog notes","developer":"alexhong","version":"0.6.6","frame":"false","beta":"false","slow":"false","file":"found","server":"up","errors":false}